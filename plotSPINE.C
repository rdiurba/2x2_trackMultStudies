#include "TH1.h"#include "TGraph.h"#include "TEfficiency.h"#include "TH2.h"#include "TF1.h"#include "TROOT.h"#include "TStyle.h"#include "TMath.h"#include "TFile.h"#include "TCanvas.h"#include "TPad.h"#include "TGraphErrors.h"#include "TVectorD.h"#include "TTimeStamp.h"#include <fstream>#include "TMinuit.h"#include "TString.h"#include <vector>#include <string.h>#include "TLatex.h"#include "TPaveStats.h"#include "TDatime.h"#include "TColor.h"#include "TProfile.h"#include "TProfile2D.h"#include <TH2.h>#include <TStyle.h>#include <TCanvas.h>#include "TPrincipal.h"#include "TDecompChol.h"#include "TEfficiency.h"#include "RooUnfoldResponse.h"#include "RooUnfoldBayes.h"#include <iomanip>void plotSPINE(){gROOT->LoadMacro("protoDUNEStyle.C");gROOT->SetStyle("protoDUNEStyle");gROOT->ForceStyle();gStyle->SetTitleX(0.35);gStyle->SetOptFit(111);TCanvas c1=TCanvas();TLatex tL;    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");TFile fPurity("testSPINEPart1.root");TFile fFakeData("testSPINEPart2.root");TFile fMinerva("testSPINEMinerva.root");TH1D* totalPOT=(TH1D*)fPurity.Get("totalPOT");totalPOT->SetName("totalPOTMC");TH1D* totalPOTFakeData=(TH1D*)fFakeData.Get("totalPOT");double ratio=1E7/totalPOTFakeData->Integral();double ratioMC=1E7/totalPOT->Integral();    TH1D* diffAngle=(TH1D*)fPurity.Get("trueDiffPosvsPDirZ");diffAngle->GetYaxis()->SetTitle("Number of Interactions");diffAngle->SetTitle("All True CC #nu_{#mu}");diffAngle->GetXaxis()->SetTitle("Diff. True Angle (Pos.-Momentum)");diffAngle->GetYaxis()->SetTitleOffset(1.4);diffAngle->Draw("HIST");c1.Print("spinePlots/diffAngleSPINE.png");TH1D* trueEl=(TH1D*)fPurity.Get("histEl");trueEl->GetXaxis()->SetTitle("True E_{#mu} [GeV]");trueEl->GetYaxis()->SetTitle("Number of Interactions");trueEl->SetTitle("All CC Interactions");trueEl->SetLineColor(kRed);trueEl->SetMarkerColor(kRed);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);trueEl->GetYaxis()->SetTitleOffset(1.5);trueEl->Draw("E0 HIST");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/trueElSPINE.png"); c1.Print("spinePlots/trueElSPINE.pdf");TH1D* backtrackEl=(TH1D*)fPurity.Get("recoBacktrackElAr");backtrackEl->GetXaxis()->SetTitle("True E_{#mu} [GeV]");backtrackEl->GetYaxis()->SetTitle("Number of Interactions");backtrackEl->SetTitle("SPINE Interactions");    backtrackEl->SetLineColor(kRed);        backtrackEl->SetMarkerColor(kRed);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);backtrackEl->GetYaxis()->SetTitleOffset(1.5);backtrackEl->Draw("E0 HIST");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/backtrackElSPINE.png"); c1.Print("spinePlots/backtrackElSPINE.pdf");TH1D* backtrackCosl=(TH1D*)fPurity.Get("trueBacktrackedCosL");TH1D* backtrackCosl_zoomOut=(TH1D*)fPurity.Get("trueBacktrackedCosL_zoomOut");backtrackCosl_zoomOut->GetXaxis()->SetTitle("True cos(#theta_{#mu})");backtrackCosl_zoomOut->GetYaxis()->SetTitle("Number of Interactions");backtrackCosl_zoomOut->SetTitle("SPINE Interactions");backtrackCosl_zoomOut->GetXaxis()->SetRangeUser(0.9,1);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);backtrackCosl_zoomOut->GetYaxis()->SetTitleOffset(1.5);backtrackCosl_zoomOut->SetLineColor(kRed);backtrackCosl_zoomOut->SetMarkerColor(kRed);backtrackCosl_zoomOut->Draw("E0 HIST");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/backtrackCoslSPINE_zoomOut.png"); c1.Print("spinePlots/backtrackCoslSPINE_zoomOut.pdf");TH1D* trackCorrectness=(TH1D*)fPurity.Get("track_correctness");trackCorrectness->GetXaxis()->SetBinLabel(1,"Primary Track");trackCorrectness->GetXaxis()->SetBinLabel(2,"Shower");trackCorrectness->GetXaxis()->SetBinLabel(3,"Split Track");trackCorrectness->GetXaxis()->SetBinLabel(4,"Secondary Track");trackCorrectness->SetTitle("SPINE Track Reconstruction");trackCorrectness->GetYaxis()->SetTitle("Fraction of Tracks");trackCorrectness->GetXaxis()->CenterTitle();trackCorrectness->GetYaxis()->CenterTitle();trackCorrectness->GetYaxis()->LabelsOption("v");trackCorrectness->Scale(1/trackCorrectness->GetEntries());trackCorrectness->GetYaxis()->SetRangeUser(0,1);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);trackCorrectness->GetYaxis()->SetTitleOffset(1.5);trackCorrectness->SetLineColor(kRed);trackCorrectness->Draw("HIST ][");c1.Print("spinePlots/trackCorrectnessSPINE.pdf");c1.Print("spinePlots/trackCorrectnessSPINE.png");TH2D* confusionMatrix=(TH2D*)fPurity.Get("confusionMatrix");confusionMatrix->SetTitle("Confusion Matrix for Particle ID");confusionMatrix->GetXaxis()->SetTitle("Reco. Particle ID");confusionMatrix->GetYaxis()->SetTitle("True Particle ID");std::vector<string> labels={"Muon", "Proton","Pion","Other"};    confusionMatrix->SetMarkerSize(2.0);confusionMatrix->GetXaxis()->CenterTitle();confusionMatrix->GetYaxis()->CenterTitle();confusionMatrix->GetYaxis()->LabelsOption("v");gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);confusionMatrix->GetYaxis()->SetTitleOffset(1.5);gStyle->SetPaintTextFormat("1.3f");    for (int i=0; i<4; i++){std::cout<<labels.at(i)<<std::endl;confusionMatrix->GetXaxis()->SetBinLabel(i+1,labels.at(i).c_str());confusionMatrix->GetYaxis()->SetBinLabel(i+1,labels.at(i).c_str());}confusionMatrix->Draw("COLZ TEXT");c1.Print("spinePlots/confusionMatrixUnNorm.pdf");c1.Print("spinePlots/confusionMatrixSPINEUnNorm.png");for (int i=0; i<4; i++){double integral=confusionMatrix->Integral(i+1,i+1,0,7);for (int j=0; j<4; j++){confusionMatrix->SetBinContent(i+1,j+1,confusionMatrix->GetBinContent(i+1,j+1)/integral);}}confusionMatrix->SetMarkerSize(2.0);confusionMatrix->GetXaxis()->CenterTitle();confusionMatrix->GetYaxis()->CenterTitle();confusionMatrix->GetYaxis()->LabelsOption("v");gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);confusionMatrix->GetYaxis()->SetTitleOffset(1.5);gStyle->SetPaintTextFormat("1.3f");confusionMatrix->Draw("COLZ TEXT");c1.Print("spinePlots/confusionMatrix.pdf");c1.Print("spinePlots/confusionMatrixSPINE.png");TH2D* responseMatrix=(TH2D*)fPurity.Get("responseMult");responseMatrix->SetName("responseMatrix");responseMatrix->SetTitle("SPINE Response Matrix");responseMatrix->GetXaxis()->SetTitle("Reco. Charged Part.");responseMatrix->GetYaxis()->SetTitle("True Charged Part.");for (int i=0; i<20; i++){double integral=responseMatrix->Integral(0,20, i+1,i+1);for (int j=0; j<20; j++){responseMatrix->SetBinContent(j+1,i+1,responseMatrix->GetBinContent(j+1,i+1)/integral);}}responseMatrix->SetMarkerSize(2.0);responseMatrix->GetXaxis()->CenterTitle();responseMatrix->GetYaxis()->CenterTitle();responseMatrix->GetXaxis()->SetRangeUser(1,6);responseMatrix->GetYaxis()->SetRangeUser(1,6);//responseMatrix->GetYaxis()->LabelsOption("v");gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);responseMatrix->GetYaxis()->SetTitleOffset(1.2);gStyle->SetPaintTextFormat("1.3f");responseMatrix->Draw("COLZ TEXT");c1.Print("spinePlots/responseMatrixSPINE.pdf");c1.Print("spinePlots/responseMatrixSPINE.png");TH1D* true_multTrkOnly=(TH1D*)fPurity.Get("true_multTrkOnly");true_multTrkOnly->GetXaxis()->CenterTitle(); true_multTrkOnly->GetYaxis()->CenterTitle();true_multTrkOnly->GetXaxis()->SetTitle("Number of True Tracks");true_multTrkOnly->GetYaxis()->SetTitle("Number of Interactions"); true_multTrkOnly->SetTitle("Truth");true_multTrkOnly->Draw("E0 HIST");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");    c1.Print("spinePlots/true_multTrkSPINE.png"); c1.Print("spinePlots/true_multTrkSPINE.pdf");TEfficiency* trkLenEff=(TEfficiency*)fPurity.Get("trueTrkLen_clone");     TH1D* trueTrkLenDummy=new TH1D("trueTrkLenDummy","trueTrkLenDummy",50,0,10);trueTrkLenDummy->SetName("trkEff");trueTrkLenDummy->SetTitle("SPINE");trueTrkLenDummy->GetXaxis()->SetRangeUser(0,10);trueTrkLenDummy->GetYaxis()->SetRangeUser(0,0.8);trueTrkLenDummy->GetXaxis()->SetTitle("True Track Length of a Pion or Proton (cm)");trueTrkLenDummy->GetYaxis()->SetTitle("SPINE Efficiency for a Reco. Track");trueTrkLenDummy->GetXaxis()->CenterTitle();trueTrkLenDummy->GetYaxis()->CenterTitle();trueTrkLenDummy->SetLineWidth(0);trkLenEff->SetLineColor(kRed);trkLenEff->SetLineStyle(kRed);trueTrkLenDummy->Draw("");   trkLenEff->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/trueTrkLenEffSPINE.png");c1.Print("spinePlots/trueTrkLenEffSPINE.pdf");TEfficiency* protonEff=(TEfficiency*)fPurity.Get("trueProtonEWithRecoInt_clone");TH1D* protonEffDummy=new TH1D("protonEffDummy","protonEffDummy",50,0,0.2);TH1D* pionEffDummy=new TH1D("pionEffDummy","pionEffDummy",50,0,0.2);protonEffDummy->SetName("protonEff");protonEffDummy->SetTitle("SPINE");protonEffDummy->GetXaxis()->SetRangeUser(0,0.2);protonEffDummy->GetYaxis()->SetRangeUser(0,0.9);protonEffDummy->GetXaxis()->SetTitle("Proton Kinetic Energy (GeV)");pionEffDummy->GetYaxis()->SetTitle("SPINE Efficiency of Forming a Track");protonEffDummy->GetXaxis()->CenterTitle();protonEffDummy->GetYaxis()->CenterTitle();protonEffDummy->SetLineWidth(0);protonEff->SetLineColor(kRed);protonEff->SetLineStyle(kRed);protonEffDummy->Draw("");protonEff->SetName("protonEff2");protonEff->SetTitle("Proton Eff. in KE (GeV)");protonEffDummy->Draw("");protonEff->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/protonEffSPINE.png");c1.Print("spinePlots/protonEffSPINE.pdf");TEfficiency* pionEff=(TEfficiency*)fPurity.Get("truePionEWithRecoInt_clone");pionEff->SetLineColor(kRed);pionEff->SetLineStyle(kRed);pionEffDummy->SetName("pionEff");pionEffDummy->SetTitle("SPINE");pionEffDummy->GetXaxis()->SetRangeUser(0,0.2);pionEffDummy->GetYaxis()->SetRangeUser(0,0.8);pionEffDummy->GetXaxis()->SetTitle("Charged Pion Kinetic Energy (GeV)");pionEffDummy->GetYaxis()->SetTitle("SPINE Efficiency of Forming a Track");pionEffDummy->GetXaxis()->CenterTitle();pionEffDummy->GetYaxis()->CenterTitle();pionEffDummy->SetLineWidth(0);pionEffDummy->Draw("");pionEff->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/pionEffSPINE.png");c1.Print("spinePlots/pionEffSPINE.pdf");TEfficiency* pionDirX=(TEfficiency*)fPurity.Get("truePionWithRecoIntDirX_clone");pionDirX->SetTitle("Pion Eff. for cos(#theta_{X})");pionDirX->Draw();    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/pionDirXSPINE.png");TEfficiency* pionDirY=(TEfficiency*)fPurity.Get("truePionWithRecoIntDirY_clone");pionDirY->SetTitle("Pion Eff. for cos(#theta_{Y})");pionDirY->Draw();    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/pionDirYSPINE.png");TEfficiency* pionDirZ=(TEfficiency*)fPurity.Get("truePionWithRecoIntDirZ_clone");pionDirZ->SetTitle("Pion Eff. for cos(#theta_{Z})");pionDirZ->Draw();    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/pionDirZSPINE.png");TEfficiency* protonDirX=(TEfficiency*)fPurity.Get("trueProtonWithRecoIntDirX_clone");protonDirX->SetTitle("Proton Eff. for cos(#theta_{X})");protonDirX->Draw();    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/protonDirXSPINE.png");TEfficiency* protonDirY=(TEfficiency*)fPurity.Get("trueProtonWithRecoIntDirY_clone");protonDirY->SetTitle("Proton Eff. for cos(#theta_{Y})");protonDirY->Draw();    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/protonDirYSPINE.png");TEfficiency* protonDirZ=(TEfficiency*)fPurity.Get("trueProtonWithRecoIntDirZ_clone");protonDirZ->SetTitle("Proton Eff. for cos(#theta_{Z})");protonDirZ->Draw();    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/protonDirZSPINE.png");TH1D* track_mult=(TH1D*)fPurity.Get("track_mult");track_mult->SetName("track_mult");track_mult->SetName("track_mult");track_mult->SetLineStyle(2);track_mult->SetLineStyle(3);track_mult->SetLineColor(kBlue);track_mult->SetLineColor(kBlack);track_mult->SetLineColor(kRed);track_mult->SetMarkerColor(kRed);track_mult->GetYaxis()->SetRangeUser(0,1.2*track_mult->GetMaximum());track_mult->SetTitle("Selected Int: Stat. Error");track_mult->GetXaxis()->CenterTitle();track_mult->GetXaxis()->SetTitle("Number of Reconstructed Tracks");track_mult->GetYaxis()->SetTitle("Number of Interactions");track_mult->GetYaxis()->CenterTitle();track_mult->Draw("HIST E0");track_mult->Draw("HIST SAME");track_mult->Draw("HIST SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");  TLegend *lSyst = new TLegend(0.3,0.5,0.8,0.9);  lSyst->SetTextFont(133);  lSyst->SetTextSize(25);  lSyst->SetHeader("RHC #nu_{#mu}/#bar{#nu_{#mu}}");  lSyst->AddEntry(track_mult,"W_{ion}=25.1 eV","l");  lSyst->AddEntry(track_mult,"W_{ion}=23.6 eV (Nominal)","l");  lSyst->AddEntry(track_mult,"W_{ion}=22.7 eV","l");  lSyst->Draw("SAME");    c1.Print("spinePlots/track_multWionSystSPINE.png"); c1.Print("spinePlots/track_multWionSystSPINE.pdf");TH1D* track_multQE=(TH1D*)fPurity.Get("track_multQE");track_multQE->SetFillColor(kRed); track_multQE->SetLineColor(kRed); track_multQE->SetLineWidth(0);TH1D* track_multMEC=(TH1D*)fPurity.Get("track_multMEC");track_multMEC->SetFillColor(kBlue); track_multMEC->SetLineColor(kBlue); track_multMEC->SetLineWidth(0);TH1D* track_multDIS=(TH1D*)fPurity.Get("track_multDIS");track_multDIS->SetFillColor(kYellow); track_multDIS->SetLineColor(kYellow); TH1D* track_multRES=(TH1D*)fPurity.Get("track_multRES");track_multRES->SetFillColor(kGreen+2); track_multRES->SetLineColor(kGreen+2); TH1D* track_multNC=(TH1D*)fPurity.Get("track_multNC");track_multNC->SetFillColor(kGray); track_multNC->SetLineColor(kGray);TH1D* track_multCOH=(TH1D*)fPurity.Get("track_multCOH");track_multCOH->SetFillColor(kCyan); track_multCOH->SetLineColor(kCyan);TH1D* track_multRock=(TH1D*)fPurity.Get("track_multRock");track_multRock->SetFillColor(kViolet); track_multRock->SetLineColor(kViolet);TH1D* track_multSec=(TH1D*)fPurity.Get("track_multSec");track_multSec->SetFillColor(kBlack); track_multSec->SetLineColor(kBlack);track_multRES->SetLineWidth(0);track_multDIS->SetLineWidth(0);track_multNC->SetLineWidth(0);track_multCOH->SetLineWidth(0);track_multRock->SetLineWidth(0);track_multSec->SetLineWidth(0);  TLegend *lTrack = new TLegend(0.5,0.5,0.8,0.9);  lTrack->SetTextFont(133);  lTrack->SetTextSize(25);  lTrack->SetHeader("RHC 1.00E20 POT");  lTrack->AddEntry(track_multQE,"CC-QE","f");  lTrack->AddEntry(track_multMEC,"CC-MEC","f");  lTrack->AddEntry(track_multDIS,"CC-DIS","f");  lTrack->AddEntry(track_multRES,"CC-RES","f");  lTrack->AddEntry(track_multCOH,"CC-COH","f");  lTrack->AddEntry(track_multNC,"NC","f");  lTrack->AddEntry(track_multRock,"Rock","f");  lTrack->AddEntry(track_multSec,"Secondary Int.","f");THStack* h1d_track=new THStack("hs","");for (int i=0; i<=track_multQE->GetNbinsX()+1; i++){track_multQE->SetBinContent(i,ratioMC*track_multQE->GetBinContent(i)); track_multMEC->SetBinContent(i,ratioMC*track_multMEC->GetBinContent(i)); track_multDIS->SetBinContent(i,ratioMC*track_multDIS->GetBinContent(i)); track_multRES->SetBinContent(i,ratioMC*track_multRES->GetBinContent(i));track_multCOH->SetBinContent(i,ratioMC*track_multCOH->GetBinContent(i)); track_multNC->SetBinContent(i,ratioMC*track_multNC->GetBinContent(i)); track_multRock->SetBinContent(i,ratioMC*track_multRock->GetBinContent(i)); track_multSec->SetBinContent(i,ratioMC*track_multSec->GetBinContent(i));}h1d_track->Add(track_multQE);h1d_track->Add(track_multMEC);h1d_track->Add(track_multDIS);h1d_track->Add(track_multRES);h1d_track->Add(track_multCOH);h1d_track->Add(track_multNC);h1d_track->Add(track_multRock);h1d_track->Add(track_multSec);TH1D* track_multGood=(TH1D*)fPurity.Get("track_multGood");track_mult->GetXaxis()->CenterTitle();track_mult->GetXaxis()->SetTitle("Number of Reconstructed Tracks");track_mult->GetYaxis()->SetTitle("Number of Interactions");track_mult->GetYaxis()->CenterTitle();track_multGood->GetXaxis()->CenterTitle();track_multGood->GetYaxis()->CenterTitle();track_multGood->GetXaxis()->SetTitle("Number of Reconstructed Tracks");track_multGood->GetYaxis()->SetTitle("Number of Interactions");track_multGood->SetTitle("SPINE Selected Interactions: Cheated");track_multGood->SetLineColor(kRed);track_multGood->SetMarkerColor(kRed);track_mult->SetLineColor(kRed);track_mult->SetMarkerColor(kRed);track_mult->SetTitle("Selected Int: Stat. Error");track_mult->GetYaxis()->SetRangeUser(0,800);track_mult->Draw("E0 HIST");    tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/track_multSPINE.png"); c1.Print("spinePlots/track_multSPINE.pdf");track_mult->GetYaxis()->SetRangeUser(0,6000);track_mult->SetLineWidth(0); track_mult->GetXaxis()->SetRangeUser(0,10);track_mult->Draw("HIST");track_mult->GetXaxis()->SetTitle("Number of Reconstructed Tracks");track_mult->GetYaxis()->SetTitle("Number of Interactions");track_mult->SetTitle("Simulated RHC CC #nu_{#mu}/#bar{#nu}_{#mu}");track_mult->GetYaxis()->SetTitleOffset(1.3);track_mult->GetXaxis()->SetRangeUser(1,10);track_mult->GetYaxis()->SetRangeUser(1,5E4);h1d_track->Draw("HIST SAME");lTrack->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/track_multStackSPINE.png"); c1.Print("spinePlots/track_multStackSPINE.pdf");track_mult->GetYaxis()->SetRangeUser(1,1E8);gPad->SetLogy(1);c1.Update();    c1.Print("spinePlots/track_multStackSPINELog.png"); c1.Print("spinePlots/track_multStackSPINELog.pdf");gPad->SetLogy(0);track_mult->SetLineWidth(track_multGood->GetLineWidth());TH2D* response=(TH2D*)fPurity.Get("responseCosL");TH2D* responseCopy=new TH2D("responseCopy","responseCopy",4,0,4,4,0,4);//Double_t edges[11]={0.9,0.967,0.979,0.985,0.9885,0.9918,0.994,0.9958,0.9974,0.9989,1};   Double_t edges[6] = {0.975, 0.98, 0.9887, 0.994, 0.9974, 1};for(int i=0;i<response->GetNbinsX();i++){double rowValue=0;double rowValueInc=0;for(int j=0;j<response->GetNbinsX();j++){rowValue=rowValue+response->GetBinContent(j+1,i+1);}//responseCopy->SetBinContent(1,i+1,missInt->GetBinContent(i+1)/rowValue);for(int j=0;j<response->GetNbinsX();j++){if(response->GetBinContent(j+1,i+1)==0){response->SetBinContent(j+1,i+1,0.00001);}responseCopy->SetBinContent(j+1,i+1,response->GetBinContent(j+1,i+1)/rowValue);} responseCopy->GetXaxis()->SetBinLabel(i+1,Form("%1.3f-%1.3f",edges[i],edges[i+1])); responseCopy->GetYaxis()->SetBinLabel(i+1,Form("%1.3f-%1.3f",edges[i],edges[i+1]));}gStyle->SetPaintTextFormat("1.3f");responseCopy->SetMarkerSize(1.5);gStyle->SetPalette(kBird);responseCopy->GetXaxis()->SetTitle("cos(#theta_{#mu,reco})");responseCopy->GetYaxis()->SetTitle("cos(#theta_{#mu,true})");responseCopy->SetTitle("SPINE Response Matrix");responseCopy->GetXaxis()->CenterTitle();responseCopy->GetYaxis()->CenterTitle();responseCopy->GetYaxis()->LabelsOption("v");gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);responseCopy->GetYaxis()->SetTitleOffset(1.9);responseCopy->GetZaxis()->SetRangeUser(0.0,1.0);responseCopy->Draw("COLZ TEXT0");    tL.SetNDC();tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/responseCosLSPINE.pdf");TH1D* trueCosL=new TH1D("trueCosL2","trueCosL2",5,edges);TH1D* recoCosL=new TH1D("recoCosL2","recoCosL2",5,edges);RooUnfoldResponse responses(trueCosL, recoCosL);int totBins=5;responses.UseOverflow();       for (int i=-1; i<totBins+1; i++){std::cout<<trueCosL->GetBinContent(i)<<std::endl;}TH1D* simCosL=(TH1D*)fPurity.Get("recoCosL");simCosL->SetName("simCosL");TH1D* selCosL=(TH1D*)fFakeData.Get("recoCosL");TH1D* truthCosL=(TH1D*)fPurity.Get("trueCosL");TH1D* missRecoCosL=(TH1D*)truthCosL->Clone("missRecoCosL");TH1D* badRecoCosL=(TH1D*)fPurity.Get("badRecoCosL");missRecoCosL->Add(backtrackCosl,-1);std::cout<<"Efficiency: "<<(truthCosL->GetEntries()-missRecoCosL->GetEntries())/truthCosL->GetEntries()<<std::endl;std::cout<<"Purity: "<<(simCosL->GetEntries()-badRecoCosL->GetEntries())/simCosL->GetEntries()<<std::endl;   for (int i=-1; i<totBins; i++){  responses.Fake(badRecoCosL->GetBinCenter(i+1),badRecoCosL->GetBinContent(i+1));   responses.Miss(missRecoCosL->GetBinCenter(i+1),missRecoCosL->GetBinContent(i+1));        for (int j=-1; j<totBins; j++){        responses.Fill(response->GetXaxis()->GetBinCenter(i+1),response->GetYaxis()->GetBinCenter(j+1), response->GetBinContent(i+1,j+1));      }}RooUnfoldBayes unfoldFakeData(&responses, selCosL,4);RooUnfoldBayes unfoldSim(&responses, simCosL,4);unfoldFakeData.SetNToys(1);TH1D* hRecoFullFakeData=(TH1D*) unfoldFakeData.Hreco(RooUnfold::kCovToy);TH1D* hRecoFullSim=(TH1D*) unfoldSim.Hreco(/*RooUnfold::kCovToy*/);TEfficiency* cosLSignalEff=new TEfficiency(*backtrackCosl,*truthCosL);cosLSignalEff->SetLineColor(kRed);cosLSignalEff->SetMarkerColor(kRed);backtrackCosl->GetXaxis()->SetTitle("True cos(#theta_{#mu})");backtrackCosl->GetYaxis()->SetTitle("Efficiency");backtrackCosl->SetTitle("Simulated RHC CC #nu_{#mu}/#bar{#nu}_{#mu}");backtrackCosl->GetXaxis()->SetRangeUser(0.975,1);backtrackCosl->GetYaxis()->SetRangeUser(0.5,1);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);backtrackCosl->GetYaxis()->SetTitleOffset(1.5);backtrackCosl->SetLineWidth(0);backtrackCosl->SetMarkerSize(0);backtrackCosl->Draw("E0 HIST");cosLSignalEff->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/cosBacktrackCoslSPINE.png"); c1.Print("spinePlots/cosBacktrackCoslSPINE.pdf");TH1D* backtrackCosL_unbinned=(TH1D*)fPurity.Get("trueBacktrackedCosL_unbinned");TH1D* truthCosL_unbinned=(TH1D*)fPurity.Get("trueCosL_unbinned");    TEfficiency* cosLSignalEff_unbinned=new TEfficiency(*backtrackCosL_unbinned,*truthCosL_unbinned);cosLSignalEff_unbinned->SetLineColor(kRed);cosLSignalEff_unbinned->SetMarkerColor(kRed);backtrackCosL_unbinned->GetXaxis()->SetTitle("True cos(#theta_{#mu})");backtrackCosL_unbinned->GetYaxis()->SetTitle("Efficiency");backtrackCosL_unbinned->SetTitle("Simulated RHC CC #nu_{#mu}/#bar{#nu}_{#mu}");backtrackCosL_unbinned->GetXaxis()->SetRangeUser(0.95,1);backtrackCosL_unbinned->GetYaxis()->SetRangeUser(0.5,1);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);backtrackCosL_unbinned->GetYaxis()->SetTitleOffset(1.5);backtrackCosL_unbinned->SetLineWidth(0);backtrackCosL_unbinned->SetMarkerSize(0);backtrackCosL_unbinned->Draw("E0 HIST");cosLSignalEff_unbinned->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/cosBacktrackCoslSPINE_unbinned.png"); c1.Print("spinePlots/cosBacktrackCoslSPINE_unbinned.pdf");    TH1D* true_multTrkOnly2=(TH1D*)fPurity.Get("true_multTrkOnly");TH1D* trueMatchMultTrkOnly=(TH1D*)fPurity.Get("backtrackTrueMult");    TEfficiency* trackMultSelEff=new TEfficiency(*trueMatchMultTrkOnly, *true_multTrkOnly2);trackMultSelEff->SetLineColor(kRed);trackMultSelEff->SetMarkerColor(kRed);trueMatchMultTrkOnly->GetXaxis()->SetTitle("True Number of Charged Hadrons");trueMatchMultTrkOnly->GetYaxis()->SetTitle("Efficiency");trueMatchMultTrkOnly->SetTitle("SPINE Selected Interactions");trueMatchMultTrkOnly->GetYaxis()->SetRangeUser(0.0,1);trueMatchMultTrkOnly->GetXaxis()->SetRangeUser(1,8);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);trueMatchMultTrkOnly->GetYaxis()->SetTitleOffset(1.5);trueMatchMultTrkOnly->SetLineWidth(0);trueMatchMultTrkOnly->SetMarkerSize(0);trueMatchMultTrkOnly->Draw("E0 HIST");trackMultSelEff->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/trackMultIntEffSPINE.png"); c1.Print("spinePlots/trackMultIntEffSPINE.pdf");        TH1D*  trueMult_unbinned=(TH1D*)fPurity.Get("trueMult_unbinned");TH1D* trueBacktrackedMult_unbinned=(TH1D*)fPurity.Get("trueBacktrackedMult_unbinned");    TEfficiency* trackMultSelEff_unbinned=new TEfficiency(*trueBacktrackedMult_unbinned, *trueMult_unbinned);trackMultSelEff_unbinned->SetLineColor(kRed);trackMultSelEff_unbinned->SetMarkerColor(kRed);trueBacktrackedMult_unbinned->GetXaxis()->SetTitle("True Number of Charged Hadrons");trueBacktrackedMult_unbinned->GetYaxis()->SetTitle("Efficiency");trueBacktrackedMult_unbinned->SetTitle("SPINE Selected Interactions");trueBacktrackedMult_unbinned->GetYaxis()->SetRangeUser(0.0,1);trueBacktrackedMult_unbinned->GetXaxis()->SetRangeUser(1,20);gPad->SetLeftMargin(0.18);gPad->SetRightMargin(0.15);trueBacktrackedMult_unbinned->GetYaxis()->SetTitleOffset(1.5);trueBacktrackedMult_unbinned->SetLineWidth(0);trueBacktrackedMult_unbinned->SetMarkerSize(0);trueBacktrackedMult_unbinned->Draw("E0 HIST");trackMultSelEff_unbinned->Draw("SAME");    tL.SetNDC();    tL.DrawLatex(0.20,0.94,"#bf{DUNE:ND-LAr 2x2}");c1.Print("spinePlots/trackMultIntEffSPINE_unbinned.png"); c1.Print("spinePlots/trackMultIntEffSPINE_unbinned.pdf");truthCosL->Scale(ratioMC);hRecoFullFakeData->Scale(ratio);truthCosL->SetLineColor(kBlue);hRecoFullFakeData->SetLineColor(kRed);hRecoFullFakeData->SetMarkerColor(kRed);          TLegend *lVertex = new TLegend(0.4,0.7,0.8,0.85);  lVertex->SetTextFont(133);  lVertex->SetTextSize(25);  lVertex->SetHeader(Form("RHC %1.2fE20 POT",totalPOTFakeData->GetBinContent(1)*ratio/1E7));  lVertex->AddEntry(hRecoFullFakeData,"Unfolded Fake Data","lp");  lVertex->AddEntry(truthCosL,"True Simulation","l");truthCosL->GetYaxis()->SetRangeUser(0,hRecoFullFakeData->GetMaximum()*1.6);truthCosL->GetXaxis()->SetTitle("Unfolded cos(#theta_{#mu})");truthCosL->GetYaxis()->SetTitle("Number of Interactions per Bin");    truthCosL->SetTitle("SPINE CC #nu_{#mu}");        truthCosL->GetYaxis()->SetTitleOffset(1.5);truthCosL->Draw("HIST ][");hRecoFullFakeData->Draw("E0 P SAME");      tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}"); lVertex->Draw("SAME");c1.Print("spinePlots/unfoldedFakeDataCosLSPINE.png"); c1.Print("spinePlots/unfoldedFakeDataCosLSPINE.pdf");    int binsMult=7;  Double_t edgesMult[8]={1,2,3,4,5,6,8,10};    TH1D* trueMult=new TH1D("trueMult2","trueMult2",binsMult,edgesMult);TH1D* recoMult=new TH1D("recoMult2","recoMult2",binsMult,edgesMult);RooUnfoldResponse responsesMults(trueMult, recoMult);responsesMults.UseOverflow();TH1D* trackMultBad=(TH1D*)fPurity.Get("track_multBad");TH1D* simMult=(TH1D*)fPurity.Get("track_mult");simMult->SetName("sim_mult");TH1D* selMult=(TH1D*)fFakeData.Get("track_mult");TH1D* truthMult=(TH1D*)fPurity.Get("true_multTrkOnly");selMult->SetLineColor(kRed); selMult->SetMarkerColor(kRed);    truthMult->SetLineColor(kBlue); truthMult->SetMarkerColor(kBlue);          TLegend *lVertex2 = new TLegend(0.4,0.7,0.8,0.85);  lVertex2->SetTextFont(133);  lVertex2->SetTextSize(25);  lVertex2->SetHeader(Form("RHC %1.2fE20 POT",totalPOTFakeData->GetBinContent(1)*ratio/1E7));  lVertex2->AddEntry(selMult,"MC Selected Interactions","lp");          TLegend *lVertex3 = new TLegend(0.4,0.7,0.8,0.85);  lVertex3->SetTextFont(133);  lVertex3->SetTextSize(25);  lVertex3->SetHeader(Form("RHC %1.2fE20 POT",totalPOTFakeData->GetBinContent(1)*ratio/1E7));  lVertex3->AddEntry(truthMult,"True CC Interactions","lp");TH1D* missRecoMult=(TH1D*)truthMult->Clone("missRecoMult");missRecoMult->Add(trueMatchMultTrkOnly,-1);TH2D* responseMult=(TH2D*)fPurity.Get("responseMult");   for (int i=-1; i<binsMult+1; i++){  responsesMults.Fake(trackMultBad->GetBinCenter(i+1),trackMultBad->GetBinContent(i+1));   responsesMults.Miss(missRecoMult->GetBinCenter(i+1),missRecoMult->GetBinContent(i+1));        for (int j=-1; j<binsMult+1; j++){        responsesMults.Fill(responseMult->GetXaxis()->GetBinCenter(i+1),responseMult->GetYaxis()->GetBinCenter(j+1), responseMult->GetBinContent(i+1,j+1));      }}RooUnfoldBayes unfoldFakeDataMult(&responsesMults, selMult,4);RooUnfoldBayes unfoldSimMult(&responsesMults, simMult,4);unfoldFakeDataMult.SetNToys(1);TH1D* hMultFakeData=(TH1D*) unfoldFakeDataMult.Hreco(RooUnfold::kCovToy);TH1D* hMultFullSim=(TH1D*) unfoldSimMult.Hreco(/*RooUnfold::kCovToy*/);   for (int i=0; i<binsMult; i++){std::cout<<hMultFakeData->GetBinContent(i+1)<<","<<truthMult->GetBinContent(i+1)<<","<<hMultFullSim->GetBinContent(i+1)<<std::endl;}truthMult->Scale(ratioMC);hMultFakeData->Scale(ratio);selMult->Scale(ratio);truthMult->SetLineColor(kBlue);hMultFakeData->SetLineColor(kRed);hMultFakeData->SetMarkerColor(kRed);  lVertex->SetTextFont(133);  lVertex->SetTextSize(25);  lVertex->SetHeader(Form("%1.2fE20 POT",totalPOTFakeData->GetBinContent(1)*ratio/1E7));truthMult->GetYaxis()->SetRangeUser(0,hMultFakeData->GetMaximum()*1.6);truthMult->GetXaxis()->SetTitle("Number of Charged Particles");truthMult->GetYaxis()->SetTitle("Number of Interactions per Bin");    truthMult->GetYaxis()->SetTitleOffset(1.5);    truthMult->SetTitle("SPINE CC #nu_{#mu}");truthMult->Draw("HIST ][");hMultFakeData->Draw("E0 P SAME");      tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}"); lVertex->Draw("SAME");c1.Print("spinePlots/unfoldedFakeDataMultSPINE.png"); c1.Print("spinePlots/unfoldedFakeDataMultSPINE.pdf");  std::cout<<ratio<<std::endl;selCosL->Scale(ratio);selCosL->SetLineColor(kRed); selCosL->SetMarkerColor(kRed);selCosL->GetYaxis()->SetRangeUser(0,50000);selCosL->GetXaxis()->SetTitle("Number of Charged Particles");selCosL->GetYaxis()->SetTitle("Number of Interactions per Bin");    selCosL->GetYaxis()->SetTitleOffset(1.5);    selCosL->SetTitle("Simulated RHC CC #nu_{#mu}/#bar{#nu}_{#mu}");selCosL->Draw("HIST ][");      tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}"); lVertex2->Draw("SAME");c1.Print("spinePlots/selFakeDataCosLSPINE.png"); c1.Print("spinePlots/selFakeDataCosLSPINE.pdf");  selMult->GetYaxis()->SetRangeUser(0,50000);selMult->GetXaxis()->SetTitle("Number of Charged Particles");selMult->GetYaxis()->SetTitle("Number of Interactions per Bin");    selMult->GetYaxis()->SetTitleOffset(1.5);    selMult->SetTitle("Simulated RHC CC #nu_{#mu}/#bar{#nu}_{#mu}");selMult->Draw("HIST ][");      tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}"); lVertex2->Draw("SAME");c1.Print("spinePlots/selFakeDataMultSPINE.png"); c1.Print("spinePlots/selFakeDataMultSPINE.pdf");  truthMult->SetLineColor(kBlue);truthMult->SetMarkerColor(kBlue);truthMult->GetYaxis()->SetRangeUser(0,50000);truthMult->GetXaxis()->SetTitle("Number of True Charged Particles");truthMult->GetYaxis()->SetTitle("Number of Interactions per Bin");    truthMult->GetYaxis()->SetTitleOffset(1.5);    truthMult->SetTitle("Simulated RHC CC #nu_{#mu}/#bar{#nu}_{#mu}");truthMult->Draw("HIST ][");      tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}");    lVertex3->Draw("SAME");c1.Print("spinePlots/trueFakeDataMultSPINE.png"); c1.Print("spinePlots/trueFakeDataMultSPINE.pdf");  truthCosL->SetLineColor(kBlue);truthCosL->SetMarkerColor(kBlue);truthCosL->Draw("HIST ][");      tL.SetNDC();    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}");    lVertex3->Draw("SAME");c1.Print("spinePlots/trueFakeDataCosLSPINE.png"); c1.Print("spinePlots/trueFakeDataCosLSPINE.pdf");         for (int i=-1; i<totBins; i++){std::cout<<hRecoFullFakeData->GetBinContent(i+1)<<","<<truthCosL->GetBinContent(i+1)<<","<<hRecoFullSim->GetBinContent(i+1)*ratio<<std::endl;}std::cout<<hRecoFullFakeData->Integral()<<","<<truthCosL->Integral()<<std::endl;std::cout<<ratio<<std::endl;TH1D* intPerSpill=(TH1D*)fPurity.Get("trueIntPerSpill");intPerSpill->Scale(1.f/intPerSpill->GetEntries());intPerSpill->GetXaxis()->SetTitle("Number of Interactions per Spill");intPerSpill->GetYaxis()->SetTitle("Fraction of Spills");intPerSpill->SetTitle("RHC NuMI");intPerSpill->GetYaxis()->SetRangeUser(1E-6,1);gPad->SetLogy();intPerSpill->SetLineColor(kBlue); intPerSpill->SetMarkerColor(kBlue);    intPerSpill->Draw("HIST ][");    tL.DrawLatex(0.25,0.94,"#bf{DUNE:ND-LAr 2x2}");  c1.Print("spinePlots/trueIntPerSpillSPINE.png"); c1.Print("spinePlots/trueIntPerSpillSPINE.pdf");  }